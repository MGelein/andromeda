"use strict";var andromeda={version:0.1,author:"Mees Gelein"};(function(c){var j="http://www.perseus.tufts.edu/hopper/loadquery";var a="http://www.perseus.tufts.edu/hopper/searchresults?q=";var b="http://www.perseus.tufts.edu/hopper/";var k=10;var l="?doc=Perseus:text:1999.04.0057:entry=kate/rxomai";var i="?doc=Perseus:text:1999.04.0057:entry=kate/rxomai";var q="?doc=Perseus:text:1999.04.0073:entry=kate/rxomai";var n="?doc=Perseus:text:1999.04.0059:entry=tu";var o="?doc=Perseus:text:1999.04.0060:entry=tu";var g=function(){var v=$("#loadFromPerseusQuery").val().trim();$("#loadFromPerseusQuery").val("");if(v.length==0){return}$("#loadFromPerseusButton").val("Loading...").removeClass("btn-primary").addClass("btn-warning");var u=v;if(!v.startsWith("http")){u=a+encodeURI(v)}$.ajax({url:u,success:function(y){if(y.indexOf("<title>Perseus Search results</title>")!=-1||y.indexOf('<link href="/js/perseusld/perseusld.css" rel="stylesheet" type="text/css"/>')==-1){$("#loadFromPerseusButton").val("Not A Known Text").removeClass("btn-warning").addClass("btn-danger");setTimeout(function(){$("#loadFromPerseusButton").val("Load From Perseus").removeClass("btn-danger").addClass("btn-primary")},2000)}else{y=y.replace(/<img[^>]*>/g,"");var x=$(y);var A=x.find(".current").get(0);c.environment.text.doc=j+$(A).attr("href");c.environment.text.name=$(A).attr("title");c.environment.text.title=$(x.find("#header_text").get(0)).find("h1").get(0).textContent;h();var z=0;while(true){var B=x.find("#translation"+z+" .header");if(B.length<1){break}var w=B.get(0);c.environment.translations.push({title:w.textContent.split("\n")[3],doc:j+$($(w).find(".toggle").get(1)).attr("href").replace("text","")});z++}m()}r()}})};var t=function(u,v){$("#translationContent").html(u);$("#translationHeader").html('Translation: <span class="titleName">'+v+"</span>")};var m=function(){$("#translationContent").html("");c.environment.translations.dropdown="";$.each(c.environment.translations,function(u,v){$.ajax({url:v.doc,success:function(w){w=w.replace(/<hr[^>]*>/g,"");w=w.replace(/<img[^>]*>/g,"");v.data=w;c.environment.translations.dropdown+="<div class='dropdownLink' resultIndex='"+u+"'><span class='dropdownIcon'/>"+v.title+"</div>";if(u==0){t(w,v.title)}}})});$("#translationHeader").unbind("click").click(function(v){v.stopPropagation();var u=$("#headerDropdown");if(!c.ui.dropdownShowing){c.ui.dropdownShowing=true;var w=function(){var x=$("#translationHeader");var y=x.offset();u.offset({top:0,left:0});u.html(c.environment.translations.dropdown);u.offset({top:y.top+x.height(),left:y.left});u.innerWidth(x.outerWidth())};w();$(window).unbind("resize").resize(w);$(document).click(function(){e()});u.find(".dropdownLink").each(function(x,y){if($("#translationHeader").text().indexOf($(y).text())==-1){return}$($(y).find(".dropdownIcon").get(0)).addClass("dropdownActiveIcon")});u.fadeIn();u.find(".dropdownLink").click(function(x){t(c.environment.translations[$(this).attr("resultIndex")].data,$(this).text())})}else{e()}})};var e=function(){var u=$("#headerDropdown");$(window).unbind("resize");$(document).unbind("click");c.ui.dropdownShowing=false;u.html("");u.offset({top:0,left:0});u.innerWidth(0);u.hide()};var h=function(){$("#textHeader").html("Text: Loading");$("#textContent").html("");$.ajax({url:c.environment.text.doc,success:function(u){u=u.replace(/<hr[^>]*>/g,"");$("#textContent").html(u);$("#textHeader").html('Text: <span class="titleName">'+c.environment.text.title+" | "+c.environment.text.name+"</span>");d()}})};var p=function(u,v){$("#dictionaryHeader").html("Dictionary: "+v);$("#dictionaryContent").html(u)};var f=function(v,x){var u=b+v;var w=false;$.each(c.environment.dictionary.cache,function(y,z){if(z.wordUrl==u){p(z.data,z.wordTitle);w=true}});if(w){return}$.ajax({url:u,success:function(y){y=y.replace(/<img[^>]*>/g,"");var z=$(y).find("#main_col").get(0);$("#dictionaryContent").html(z.innerHTML);$("#dictionaryContent table").addClass("table table-condensed table-striped");$("#dictionaryContent .word_freq").remove();$("#dictionaryContent p").remove();p($("#dictionaryContent").html(),x);var A={wordTitle:x,data:$("#dictionaryContent").html(),wordUrl:u};c.environment.dictionary.cache.unshift(A);if(c.environment.dictionary.cache.length>k){c.environment.dictionary.cache.pop()}c.environment.dictionary.dropdown="";$.each(c.environment.dictionary.cache,function(B,C){c.environment.dictionary.dropdown+="<div class='dropdownLink' resultIndex="+B+"><span class='dropdownIcon'/>"+C.wordTitle+"</div>"});$("#dictionaryHeader").unbind("click").click(function(C){C.stopPropagation();var B=$("#headerDropdown");if(!c.ui.dropdownShowing){c.ui.dropdownShowing=true;var D=function(){var E=$("#dictionaryHeader");var F=E.offset();B.offset({top:0,left:0});B.html(c.environment.dictionary.dropdown);B.offset({top:F.top+E.height(),left:F.left});B.innerWidth(E.outerWidth())};D();$(window).unbind("resize").resize(D);$(document).click(function(){e()});B.find(".dropdownLink").each(function(E,F){if($("#dictionaryHeader").text().indexOf($(F).text())==-1){return}$($(F).find(".dropdownIcon").get(0)).addClass("dropdownActiveIcon")});B.fadeIn();B.find(".dropdownLink").click(function(E){p(c.environment.dictionary.cache[$(this).attr("resultIndex")].data,$(this).text())})}else{e()}})}})};var d=function(){$(".text a").unbind("click").attr("onclick","");$(".text a").click(function(x){x.preventDefault();var v=$(this).prevAll("span").get(0);var u=(v==undefined)?"":v.textContent;var w=$(this).text()+((v==undefined)?"":(": "+u));f($(this).attr("href"),w)})};var r=function(){$(".greyed-out").removeClass("greyed-out")};var s=function(){$("#loadFromPerseusButton").click(function(){andromeda.search.perseus()});$("#loadFromPerseusQuery").keydown(function(u){if(u.keyCode==13){g()}})};c.search={perseus:g};c.ui={registerClickHandlers:s,dropdownShowing:false};c.environment={text:{},translations:[],dictionary:{cache:[]}}})(andromeda);$(document).ready(function(){andromeda.ui.registerClickHandlers();$("#headerDropdown").hide()});