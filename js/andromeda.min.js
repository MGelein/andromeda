"use strict";var andromeda={version:0.1,author:"Mees Gelein"};(function(e){var h="http://www.perseus.tufts.edu/hopper/loadquery";var g="http://www.perseus.tufts.edu/hopper/searchresults?q=";var f="http://www.perseus.tufts.edu/hopper/";var c=function(){var l=$("#loadFromPerseusQuery").val().trim();$("#loadFromPerseusQuery").val("");if(l.length==0){return}$("#loadFromPerseusButton").val("Loading...").removeClass("btn-primary").addClass("btn-warning");var k=l;if(!l.startsWith("http")){k=g+encodeURI(l)}$.ajax({url:k,success:function(o){if(o.indexOf("<title>Perseus Search results</title>")!=-1||o.indexOf('<link href="/js/perseusld/perseusld.css" rel="stylesheet" type="text/css"/>')==-1){$("#loadFromPerseusButton").val("Not A Known Text").removeClass("btn-warning").addClass("btn-danger");setTimeout(function(){$("#loadFromPerseusButton").val("Load From Perseus").removeClass("btn-danger").addClass("btn-primary")},2000)}else{o=o.replace(/<img[^>]*>/g,"");var n=$(o);var r=n.find(".current").get(0);e.environment.textDoc=$(r).attr("href");e.environment.textName=$(r).attr("title");var s=$(n.find("#header_text").get(0)).find("h1").get(0).textContent;e.environment.textTitle=s;b("text",e.environment.textDoc);var q=n.find("#translation0 .header").get(0);e.environment.transTitle=q.textContent.split("\n")[3];e.environment.transDoc=$($(q).find(".toggle").get(1)).attr("href").replace("text","");b("translation",e.environment.transDoc);var p=0;while(true){var t=n.find("#translation"+p+" .header");if(t.length<1){break}var m=t.get(0);e.environment.translations.push({title:m.textContent.split("\n")[3],doc:$($(q).find(".toggle").get(1)).attr("href").replace("text","")});p++}console.log(e.environment.translations)}a()}})};var b=function(m,l){m=m.toLowerCase().trim();var k=h+l;if(m=="text"){$("#textHeader").html("Text: Loading");$("#textContent").html("")}else{if(m=="translation"){$("#translationHeader").html("Translation: Loading");$("#textContent").html("")}}$.ajax({url:k,success:function(n){n=n.replace(/<hr[^>]*>/g,"");if(m=="text"){$("#textContent").html(n);$("#textHeader").html('Text: <span class="titleName">'+e.environment.textTitle+" | "+e.environment.textName+"</span>")}else{if(m=="translation"){$("#translationContent").html(n);$("#translationHeader").html('Translation: <span class="titleName">'+e.environment.transTitle+"</span>")}}d()}})};var j=function(l){var k=f+l;$.ajax({url:k,success:function(m){m=m.replace(/<img[^>]*>/g,"");var n=$(m).find("#main_col").get(0);$("#dictionaryContent").html(n.innerHTML);$("#dictionaryContent table").addClass("table table-condensed table-striped");$("#dictionaryContent .word_freq").remove();$("#dictionaryContent p").remove()}})};var d=function(){$(".text a").unbind("click").attr("onclick","");$(".text a").click(function(k){k.preventDefault();j($(this).attr("href"))})};var a=function(){$(".greyed-out").removeClass("greyed-out")};var i=function(){$("#loadFromPerseusButton").click(function(){andromeda.search.perseus()});$("#loadFromPerseusQuery").keydown(function(k){if(k.keyCode==13){c()}})};e.search={perseus:c};e.ui={registerClickHandlers:i};e.environment={textDoc:"",textTitle:"",textName:"",translations:[]}})(andromeda);$(document).ready(function(){andromeda.ui.registerClickHandlers()});