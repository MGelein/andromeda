"use strict";var andromeda={version:0.1,author:"Mees Gelein"};(function(f){var n="http://www.perseus.tufts.edu/hopper/loadquery";var d="http://www.perseus.tufts.edu/hopper/searchresults?q=";var e="http://www.perseus.tufts.edu/hopper/";var o=10;var c="<div class='row'><hr><div class='col-sm-12 text-center'><h4>Navigation</h4></div><div class='col-sm-6 text-center'><span id='prevSeg' class='greyed-out'>◀&nbsp;Previous Segment</span></div><div class='col-sm-6 text-center'><span id='nextSeg' class='greyed-out'>&nbsp;Next Segment&nbsp;▶</span></div><hr><div class='col-sm-12 text-center'><h4>Save &amp; Load</h4></div></div>";var l=function(){var u=$("#loadFromPerseusQuery").val().trim();$("#loadFromPerseusQuery").val("");if(u.length==0){return}$("#loadFromPerseusButton").val("Loading...").removeClass("btn-primary").addClass("btn-warning");var t=u;if(!u.startsWith("http")){t=d+encodeURI(u)}b(t)};var b=function(t){var u="<br><h3>No Dictionary</h3><p>There are no word queries to display. To get started using the dictionary click a word in the main text in the middle column.</p>";var v="<br><h3>No Notes</h3><p>There are no notes to display. To get started taking notes make a selection in the main text in the middle column and press the 'Add Note' button.</p>";$("#dictionaryContent").html(u);$("#noteContent").html(v);f.environment.translations=[];f.environment.text={};$.ajax({url:t,success:function(y){if(y.indexOf("<title>Perseus Search results</title>")!=-1||y.indexOf('<link href="/js/perseusld/perseusld.css" rel="stylesheet" type="text/css"/>')==-1){$("#loadFromPerseusButton").val("Not A Known Text").removeClass("btn-warning").addClass("btn-danger");setTimeout(function(){$("#loadFromPerseusButton").val("Load From Perseus").removeClass("btn-danger").addClass("btn-primary")},2000)}else{y=y.replace(/<img/g,"<span");var x=$(y);f.environment.text.locus="";x.find(".current").each(function(F,G){var E=$(G).attr("title");E=f.util.ucfirst(E);E=E.trim();if(E.indexOf("ection")!=-1){f.environment.text.locus+=E.replace("Section ",".")}else{f.environment.text.locus+=", "+E}});f.environment.text.locus=f.environment.text.locus.substr(2);var B=x.find(".current").filter(":last").get(0);f.environment.text.doc=n+$(B).attr("href");f.environment.text.title=$(x.find("#header_text").get(0)).find("h1").get(0).textContent;var A=x.find('.arrow span[alt="next"]').get(0);var C=x.find('.arrow span[alt="previous"]').get(0);if(A!=undefined){f.environment.text.next=e+$(A).parent().attr("href")}else{f.environment.text.next=undefined}if(C!=undefined){f.environment.text.prev=e+$(C).parent().attr("href")}else{f.environment.text.prev=undefined}m();var z=0;while(true){var D=x.find("#translation"+z+" .header");if(D.length<1){break}var w=D.get(0);f.environment.translations.push({title:w.textContent.split("\n")[3],doc:n+$($(w).find(".toggle").get(1)).attr("href").replace("text","")});z++}p()}$(".greyed-out").removeClass("greyed-out");h()}})};var s=function(t,u){$("#translationContent").html(t);$("#translationHeader").html('Translation: <span class="titleName">'+u+"</span>")};var p=function(){$("#translationContent").html("");f.environment.translations.dropdown="";$.each(f.environment.translations,function(t,u){$.ajax({url:u.doc,success:function(v){v=v.replace(/<hr[^>]*>/g,"");v=v.replace(/<img[^>]*>/g,"");u.data=v;f.environment.translations.dropdown+="<div class='dropdownLink' resultIndex='"+t+"'><span class='dropdownIcon'/>"+u.title+"</div>";if(t==0){s(v,u.title)}}})});$("#translationHeader").unbind("click").click(function(u){u.stopPropagation();var t=$("#headerDropdown");if(!f.ui.dropdownShowing){f.ui.dropdownShowing=true;var v=function(){var w=$("#translationHeader");var x=w.offset();t.offset({top:0,left:0});t.html(f.environment.translations.dropdown);t.offset({top:x.top+w.height(),left:x.left});t.innerWidth(w.outerWidth())};v();$(window).unbind("resize").resize(v);$(document).click(function(){h()});t.find(".dropdownLink").each(function(w,x){if($("#translationHeader").text().indexOf($(x).text())==-1){return}$($(x).find(".dropdownIcon").get(0)).addClass("dropdownActiveIcon")});t.fadeIn();t.find(".dropdownLink").click(function(w){s(f.environment.translations[$(this).attr("resultIndex")].data,$(this).text())})}else{h()}})};var h=function(){var t=$("#headerDropdown");$(window).unbind("resize");$(document).unbind("click");f.ui.dropdownShowing=false;t.html("");t.offset({top:0,left:0});t.innerWidth(0);t.hide()};var m=function(){$("#textHeader").html("Text: Loading");$("#textContent").html("");$.ajax({url:f.environment.text.doc,success:function(t){t=t.replace(/<hr[^>]*>/g,"");$("#textContent").html(t);$("#textHeader").html('Text: <span class="titleName">'+f.environment.text.title+" | "+f.environment.text.locus+"</span>");g();f.environment.text.dropdown=c;$("#textHeader").unbind("click").click(function(w){w.stopPropagation();var v=$("#headerDropdown");if(!f.ui.dropdownShowing){f.ui.dropdownShowing=true;var y=function(){var z=$("#textHeader");var A=z.offset();v.offset({top:0,left:0});v.html(f.environment.text.dropdown);v.offset({top:A.top+z.height(),left:A.left});v.innerWidth(z.outerWidth())};y();$(window).unbind("resize").resize(y);$(document).click(function(){h()});if(f.environment.text.next!=undefined){var x=$(v.find("#nextSeg").get(0));x.addClass("textNav").removeClass("greyed-out");x.unbind("click").click(function(z){z.stopPropagation();x.html("Loading...");b(f.environment.text.next)})}if(f.environment.text.prev!=undefined){var u=$(v.find("#prevSeg").get(0));u.addClass("textNav").removeClass("greyed-out");u.unbind("click").click(function(z){z.stopPropagation();u.html("Loading...");b(f.environment.text.prev)})}v.fadeIn()}else{h()}})}})};var q=function(u,v,t){$("#dictionaryHeader").html("Dictionary: "+v+' <span class="locus">'+t+"</span>");$("#dictionaryContent").html(u)};var i=function(u,x,v){var t=e+u;var w=false;$.each(f.environment.dictionary.cache,function(y,z){if(z.wordUrl==t){q(z.data,z.wordTitle,z.loc);w=true}});if(w){return}$.ajax({url:t,success:function(y){y=y.replace(/<img[^>]*>/g,"");var z=$(y).find("#main_col").get(0);$("#dictionaryContent").html(z.innerHTML);$("#dictionaryContent table").addClass("table table-condensed table-striped");$("#dictionaryContent .word_freq").remove();$('#dictionaryContent a[href="#lexicon"]').each(function(A,B){$(B).closest(".lemma").append(B);$(B).addClass("btn btn-primary btn-sm lexLink");$(B).removeAttr("onclick");$(B).prop("onclick",null);$(B).attr("href","#");var C=$(B).attr("id");$(B).attr("id",C.substr(0,C.length-5))});$("#dictionaryContent p").remove();if($("#dictionaryContent").html().trim().length==0){$("#dictionaryContent").html("<h3>Sorry!</h3><p>It looks like no result could be found for that word.</p>")}$("#dictionaryContent").find(".lexLink").attr("onclick","andromeda.search.loadLexicon(event, this);");q($("#dictionaryContent").html(),x,v);j(x,$("#dictionaryContent").html(),t,v);$("#dictionaryHeader").unbind("click").click(function(B){B.stopPropagation();var A=$("#headerDropdown");if(!f.ui.dropdownShowing){f.ui.dropdownShowing=true;var C=function(){var D=$("#dictionaryHeader");var E=D.offset();A.offset({top:0,left:0});A.html(f.environment.dictionary.dropdown);A.offset({top:E.top+D.height(),left:E.left});A.innerWidth(D.outerWidth())};C();$(window).unbind("resize").resize(C);$(document).click(function(){h()});A.find(".dropdownLink").each(function(E,G){var D=$("#dictionaryHeader").text().replace("Dictionary:","").trim().replace(" ","").replace(" ","");var F=$(G).text().trim().replace(" ","");if(D!=F){return}$($(G).find(".dropdownIcon").get(0)).addClass("dropdownActiveIcon")});A.fadeIn();A.find(".dropdownLink").click(function(D){var E=f.environment.dictionary.cache[$(this).attr("resultIndex")];q(E.data,E.wordTitle,E.loc)})}else{h()}})}})};var k=function(y,x){y.stopPropagation();var z=x.textContent;var t=$(x).closest(".lemma").find("h4").get(0).textContent;var w=t+"&nbsp;<span class='lexiconName'>("+z+")</span>";var u=n+"?doc="+x.id;var v=false;$.each(f.environment.dictionary.cache,function(A,B){if(B.wordUrl==u){q(B.data,B.wordTitle,B.loc);v=true}});if(v){return}$.ajax({url:u,success:function(A){j(w,A,u,"");q(A,w)}})};var j=function(x,w,u,v){var t={wordTitle:x,data:w,wordUrl:u,loc:v};f.environment.dictionary.cache.unshift(t);if(f.environment.dictionary.cache.length>o){f.environment.dictionary.cache.pop()}f.environment.dictionary.dropdown="";$.each(f.environment.dictionary.cache,function(y,z){f.environment.dictionary.dropdown+="<div class='dropdownLink' resultIndex="+y+"><span class='dropdownIcon'/><span class='dictLemma'"+z.wordTitle+'</span><span class="locus">'+z.loc+"</span></div>"})};var g=function(){$(".text a").unbind("click").attr("onclick","");$(".text a").click(function(v){v.preventDefault();var u="<span class='dictLemma'>"+$(this).text();+"</span>";var t=a(this);i($(this).attr("href"),u,t)})};var a=function(x){var w=f.environment.text.locus;var v=$(x).prevAll("span").get(0);var t=(v==undefined)?"":v.textContent;var u=w.split(", ").pop();if(t.length<1){if(u.startsWith("Book")){t="1"}else{if(u.startsWith("Chapter")){if(u.indexOf(".")!=-1){t=""}else{t="1"}}else{if(u.startsWith("Poem")){t=""+($(x).prevAll("br").length+1)}else{if(u.startsWith("Lines")){t=u.split(" ")[1].split("-")[0]}}}}}if(u.startsWith("Lines")){w=w.replace(", "+u,"")}if(t.length>0){w+="."}return w+t};var r=function(){$("#loadFromPerseusButton").click(function(){andromeda.search.perseus()});$("#loadFromPerseusQuery").keydown(function(t){if(t.keyCode==13){l()}})};f.util={ucfirst:function(w){var x=w.split(" ");var v=[];var t;for(var u in x){t=x[u].toLowerCase();t=t.charAt(0).toUpperCase()+t.substr(1);v.push(t)}return v.join(" ")}};f.search={perseus:l,loadLexicon:k};f.ui={registerClickHandlers:r,dropdownShowing:false};f.environment={text:{},translations:[],dictionary:{cache:[]}}})(andromeda);$(document).ready(function(){andromeda.ui.registerClickHandlers();$("#headerDropdown").hide()});