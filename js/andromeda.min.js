"use strict";var andromeda={version:0.1,author:"Mees Gelein"};(function(d){var l="http://www.perseus.tufts.edu/hopper/loadquery";var b="http://www.perseus.tufts.edu/hopper/searchresults?q=";var c="http://www.perseus.tufts.edu/hopper/";var m=10;var a="<div class='row'><hr><div class='col-sm-12 text-center'><h4>Navigation</h4></div><div class='col-sm-6 text-center'><span id='prevSeg' class='textNav'>◀&nbsp;Previous&nbsp;Segment</span></div><div class='col-sm-6 text-center'><span id='nextSeg' class='textNav'>&nbsp;Next&nbsp;Segment&nbsp;▶</span></div><hr><div class='col-sm-12 text-center'><h4>Save &amp; Load</h4></div></div>";var j=function(){var t=$("#loadFromPerseusQuery").val().trim();$("#loadFromPerseusQuery").val("");if(t.length==0){return}$("#loadFromPerseusButton").val("Loading...").removeClass("btn-primary").addClass("btn-warning");var s=t;if(!t.startsWith("http")){s=b+encodeURI(t)}$.ajax({url:s,success:function(w){if(w.indexOf("<title>Perseus Search results</title>")!=-1||w.indexOf('<link href="/js/perseusld/perseusld.css" rel="stylesheet" type="text/css"/>')==-1){$("#loadFromPerseusButton").val("Not A Known Text").removeClass("btn-warning").addClass("btn-danger");setTimeout(function(){$("#loadFromPerseusButton").val("Load From Perseus").removeClass("btn-danger").addClass("btn-primary")},2000)}else{w=w.replace(/<img src=/g,"<span src=");var v=$(w);var z=v.find(".current").get(0);d.environment.text.doc=l+$(z).attr("href");d.environment.text.name=$(z).attr("title");d.environment.text.title=$(v.find("#header_text").get(0)).find("h1").get(0).textContent;var y=v.find('.arrow span[alt="next"]').get(0);var A=v.find('.arrow span[alt="previous"]').get(0);if(y!=undefined){d.environment.text.next=$(y).parent().attr("href")}if(A!=undefined){d.environment.text.prev=$(A).parent().attr("href")}k();var x=0;while(true){var B=v.find("#translation"+x+" .header");if(B.length<1){break}var u=B.get(0);d.environment.translations.push({title:u.textContent.split("\n")[3],doc:l+$($(u).find(".toggle").get(1)).attr("href").replace("text","")});x++}n()}p()}})};var r=function(s,t){$("#translationContent").html(s);$("#translationHeader").html('Translation: <span class="titleName">'+t+"</span>")};var n=function(){$("#translationContent").html("");d.environment.translations.dropdown="";$.each(d.environment.translations,function(s,t){$.ajax({url:t.doc,success:function(u){u=u.replace(/<hr[^>]*>/g,"");u=u.replace(/<img[^>]*>/g,"");t.data=u;d.environment.translations.dropdown+="<div class='dropdownLink' resultIndex='"+s+"'><span class='dropdownIcon'/>"+t.title+"</div>";if(s==0){r(u,t.title)}}})});$("#translationHeader").unbind("click").click(function(t){t.stopPropagation();var s=$("#headerDropdown");if(!d.ui.dropdownShowing){d.ui.dropdownShowing=true;var u=function(){var v=$("#translationHeader");var w=v.offset();s.offset({top:0,left:0});s.html(d.environment.translations.dropdown);s.offset({top:w.top+v.height(),left:w.left});s.innerWidth(v.outerWidth())};u();$(window).unbind("resize").resize(u);$(document).click(function(){f()});s.find(".dropdownLink").each(function(v,w){if($("#translationHeader").text().indexOf($(w).text())==-1){return}$($(w).find(".dropdownIcon").get(0)).addClass("dropdownActiveIcon")});s.fadeIn();s.find(".dropdownLink").click(function(v){r(d.environment.translations[$(this).attr("resultIndex")].data,$(this).text())})}else{f()}})};var f=function(){var s=$("#headerDropdown");$(window).unbind("resize");$(document).unbind("click");d.ui.dropdownShowing=false;s.html("");s.offset({top:0,left:0});s.innerWidth(0);s.hide()};var k=function(){$("#textHeader").html("Text: Loading");$("#textContent").html("");$.ajax({url:d.environment.text.doc,success:function(s){s=s.replace(/<hr[^>]*>/g,"");$("#textContent").html(s);$("#textHeader").html('Text: <span class="titleName">'+d.environment.text.title+" | "+d.environment.text.name+"</span>");e();d.environment.text.dropdown=a;$("#textHeader").unbind("click").click(function(u){u.stopPropagation();var t=$("#headerDropdown");if(!d.ui.dropdownShowing){d.ui.dropdownShowing=true;var v=function(){var w=$("#textHeader");var x=w.offset();t.offset({top:0,left:0});t.html(d.environment.text.dropdown);t.offset({top:x.top+w.height(),left:x.left});t.innerWidth(w.outerWidth())};v();$(window).unbind("resize").resize(v);$(document).click(function(){f()});t.fadeIn()}else{f()}})}})};var o=function(s,t){$("#dictionaryHeader").html("Dictionary: "+t);$("#dictionaryContent").html(s)};var g=function(t,v){var s=c+t;var u=false;$.each(d.environment.dictionary.cache,function(w,x){if(x.wordUrl==s){o(x.data,x.wordTitle);u=true}});if(u){return}$.ajax({url:s,success:function(w){w=w.replace(/<img[^>]*>/g,"");var x=$(w).find("#main_col").get(0);$("#dictionaryContent").html(x.innerHTML);$("#dictionaryContent table").addClass("table table-condensed table-striped");$("#dictionaryContent .word_freq").remove();$('#dictionaryContent a[href="#lexicon"]').each(function(y,z){$(z).closest(".lemma").append(z);$(z).addClass("btn btn-primary btn-sm lexLink");$(z).removeAttr("onclick");$(z).prop("onclick",null);$(z).attr("href","#");var A=$(z).attr("id");$(z).attr("id",A.substr(0,A.length-5))});$("#dictionaryContent p").remove();$("#dictionaryContent").find(".lexLink").attr("onclick","andromeda.search.loadLexicon(event, this);");o($("#dictionaryContent").html(),v);h(v,$("#dictionaryContent").html(),s);$("#dictionaryHeader").unbind("click").click(function(z){z.stopPropagation();var y=$("#headerDropdown");if(!d.ui.dropdownShowing){d.ui.dropdownShowing=true;var A=function(){var B=$("#dictionaryHeader");var C=B.offset();y.offset({top:0,left:0});y.html(d.environment.dictionary.dropdown);y.offset({top:C.top+B.height(),left:C.left});y.innerWidth(B.outerWidth())};A();$(window).unbind("resize").resize(A);$(document).click(function(){f()});y.find(".dropdownLink").each(function(B,C){if($("#dictionaryHeader").text().indexOf($(C).text())==-1){return}$($(C).find(".dropdownIcon").get(0)).addClass("dropdownActiveIcon")});y.fadeIn();y.find(".dropdownLink").click(function(B){var C=d.environment.dictionary.cache[$(this).attr("resultIndex")];o(C.data,C.wordTitle)})}else{f()}})}})};var i=function(x,w){x.stopPropagation();var y=w.textContent;var s=$(w).closest(".lemma").find("h4").get(0).textContent;var v=s+"&nbsp;<span class='lexiconName'>("+y+")</span>";var t=l+"?doc="+w.id;var u=false;$.each(d.environment.dictionary.cache,function(z,A){if(A.wordUrl==t){o(A.data,A.wordTitle);u=true}});if(u){return}$.ajax({url:t,success:function(z){h(v,z,t);o(z,v)}})};var h=function(v,u,t){var s={wordTitle:v,data:u,wordUrl:t};d.environment.dictionary.cache.unshift(s);if(d.environment.dictionary.cache.length>m){d.environment.dictionary.cache.pop()}d.environment.dictionary.dropdown="";$.each(d.environment.dictionary.cache,function(w,x){d.environment.dictionary.dropdown+="<div class='dropdownLink' resultIndex="+w+"><span class='dropdownIcon'/>"+x.wordTitle+"</div>"})};var e=function(){$(".text a").unbind("click").attr("onclick","");$(".text a").click(function(v){v.preventDefault();var t=$(this).prevAll("span").get(0);var s=(t==undefined)?"":t.textContent;var u=$(this).text()+((t==undefined)?"":(": "+s));g($(this).attr("href"),u)})};var p=function(){$(".greyed-out").removeClass("greyed-out")};var q=function(){$("#loadFromPerseusButton").click(function(){andromeda.search.perseus()});$("#loadFromPerseusQuery").keydown(function(s){if(s.keyCode==13){j()}})};d.search={perseus:j,loadLexicon:i};d.ui={registerClickHandlers:q,dropdownShowing:false};d.environment={text:{},translations:[],dictionary:{cache:[]}}})(andromeda);$(document).ready(function(){andromeda.ui.registerClickHandlers();$("#headerDropdown").hide()});