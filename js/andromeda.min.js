"use strict";var andromeda={version:0.1,author:"Mees Gelein"};(function(k){var o="http://www.perseus.tufts.edu/hopper/loadquery";var n="http://www.perseus.tufts.edu/hopper/searchresults?q=";var m="http://www.perseus.tufts.edu/hopper/";var h=10;var i=function(){var s=$("#loadFromPerseusQuery").val().trim();$("#loadFromPerseusQuery").val("");if(s.length==0){return}$("#loadFromPerseusButton").val("Loading...").removeClass("btn-primary").addClass("btn-warning");var r=s;if(!s.startsWith("http")){r=n+encodeURI(s)}$.ajax({url:r,success:function(v){if(v.indexOf("<title>Perseus Search results</title>")!=-1||v.indexOf('<link href="/js/perseusld/perseusld.css" rel="stylesheet" type="text/css"/>')==-1){$("#loadFromPerseusButton").val("Not A Known Text").removeClass("btn-warning").addClass("btn-danger");setTimeout(function(){$("#loadFromPerseusButton").val("Load From Perseus").removeClass("btn-danger").addClass("btn-primary")},2000)}else{v=v.replace(/<img[^>]*>/g,"");var u=$(v);var x=u.find(".current").get(0);k.environment.text.doc=o+$(x).attr("href");k.environment.text.name=$(x).attr("title");k.environment.text.title=$(u.find("#header_text").get(0)).find("h1").get(0).textContent;a();var w=0;while(true){var y=u.find("#translation"+w+" .header");if(y.length<1){break}var t=y.get(0);k.environment.translations.push({title:t.textContent.split("\n")[3],doc:o+$($(t).find(".toggle").get(1)).attr("href").replace("text","")});w++}d()}e()}})};var f=function(r,s){$("#translationContent").html(r);$("#translationHeader").html('Translation: <span class="titleName">'+s+"</span>")};var d=function(){$("#translationContent").html("");k.environment.translations.dropdown="";$.each(k.environment.translations,function(r,s){$.ajax({url:s.doc,success:function(t){t=t.replace(/<hr[^>]*>/g,"");t=t.replace(/<img[^>]*>/g,"");s.data=t;k.environment.translations.dropdown+="<div class='dropdownLink' resultIndex='"+r+"'><span class='dropdownIcon'/>"+s.title+"</div>";if(r==0){f(t,s.title)}}})});$("#translationHeader").unbind("click").click(function(s){s.stopPropagation();var r=$("#headerDropdown");if(!k.ui.dropdownShowing){k.ui.dropdownShowing=true;var t=function(){var u=$("#translationHeader");var v=u.offset();r.offset({top:0,left:0});r.html(k.environment.translations.dropdown);r.offset({top:v.top+u.height(),left:v.left});r.innerWidth(u.outerWidth())};t();$(window).unbind("resize").resize(t);$(document).click(function(){c()});r.find(".dropdownLink").each(function(u,v){if($("#translationHeader").text().indexOf($(v).text())==-1){return}$($(v).find(".dropdownIcon").get(0)).addClass("dropdownActiveIcon")});r.fadeIn();r.find(".dropdownLink").click(function(u){f(k.environment.translations[$(this).attr("resultIndex")].data,$(this).text())})}else{c()}})};var c=function(){var r=$("#headerDropdown");$(window).unbind("resize");$(document).unbind("click");k.ui.dropdownShowing=false;r.html("");r.offset({top:0,left:0});r.innerWidth(0);r.hide()};var a=function(){$("#textHeader").html("Text: Loading");$("#textContent").html("");$.ajax({url:k.environment.text.doc,success:function(r){r=r.replace(/<hr[^>]*>/g,"");$("#textContent").html(r);$("#textHeader").html('Text: <span class="titleName">'+k.environment.text.title+" | "+k.environment.text.name+"</span>");j()}})};var b=function(r,s){$("#dictionaryHeader").html("Dictionary: "+s);$("#dictionaryContent").html(r)};var q=function(s,u){var r=m+s;var t=false;$.each(k.environment.dictionary.cache,function(v,w){if(w.wordUrl==r){b(w.data,w.wordTitle);t=true}});if(t){return}$.ajax({url:r,success:function(v){v=v.replace(/<img[^>]*>/g,"");var w=$(v).find("#main_col").get(0);$("#dictionaryContent").html(w.innerHTML);$("#dictionaryContent table").addClass("table table-condensed table-striped");$("#dictionaryContent .word_freq").remove();$('#dictionaryContent a[href="#lexicon"]').each(function(x,y){$(y).closest(".lemma").append(y);$(y).addClass("btn btn-primary btn-sm lexLink");$(y).removeAttr("onclick");$(y).prop("onclick",null);$(y).attr("href","#");var z=$(y).attr("id");$(y).attr("id",z.substr(0,z.length-5))});$("#dictionaryContent p").remove();$("#dictionaryContent").find(".lexLink").attr("onclick","andromeda.search.loadLexicon(event, this);");b($("#dictionaryContent").html(),u);g(u,$("#dictionaryContent").html(),r);$("#dictionaryHeader").unbind("click").click(function(y){y.stopPropagation();var x=$("#headerDropdown");if(!k.ui.dropdownShowing){k.ui.dropdownShowing=true;var z=function(){var A=$("#dictionaryHeader");var B=A.offset();x.offset({top:0,left:0});x.html(k.environment.dictionary.dropdown);x.offset({top:B.top+A.height(),left:B.left});x.innerWidth(A.outerWidth())};z();$(window).unbind("resize").resize(z);$(document).click(function(){c()});x.find(".dropdownLink").each(function(A,B){if($("#dictionaryHeader").text().indexOf($(B).text())==-1){return}$($(B).find(".dropdownIcon").get(0)).addClass("dropdownActiveIcon")});x.fadeIn();x.find(".dropdownLink").click(function(A){var B=k.environment.dictionary.cache[$(this).attr("resultIndex")];b(B.data,B.wordTitle)})}else{c()}})}})};var l=function(w,v){w.stopPropagation();var x=v.textContent;var r=$(v).closest(".lemma").find("h4").get(0).textContent;var u=r+"&nbsp;<span class='lexiconName'>("+x+")</span>";var s=o+"?doc="+v.id;var t=false;$.each(k.environment.dictionary.cache,function(y,z){if(z.wordUrl==s){b(z.data,z.wordTitle);t=true}});if(t){return}$.ajax({url:s,success:function(y){g(u,y,s);b(y,u)}})};var g=function(u,t,s){var r={wordTitle:u,data:t,wordUrl:s};k.environment.dictionary.cache.unshift(r);if(k.environment.dictionary.cache.length>h){k.environment.dictionary.cache.pop()}k.environment.dictionary.dropdown="";$.each(k.environment.dictionary.cache,function(v,w){k.environment.dictionary.dropdown+="<div class='dropdownLink' resultIndex="+v+"><span class='dropdownIcon'/>"+w.wordTitle+"</div>"})};var j=function(){$(".text a").unbind("click").attr("onclick","");$(".text a").click(function(u){u.preventDefault();var s=$(this).prevAll("span").get(0);var r=(s==undefined)?"":s.textContent;var t=$(this).text()+((s==undefined)?"":(": "+r));q($(this).attr("href"),t)})};var e=function(){$(".greyed-out").removeClass("greyed-out")};var p=function(){$("#loadFromPerseusButton").click(function(){andromeda.search.perseus()});$("#loadFromPerseusQuery").keydown(function(r){if(r.keyCode==13){i()}})};k.search={perseus:i,loadLexicon:l};k.ui={registerClickHandlers:p,dropdownShowing:false};k.environment={text:{},translations:[],dictionary:{cache:[]}}})(andromeda);$(document).ready(function(){andromeda.ui.registerClickHandlers();$("#headerDropdown").hide()});