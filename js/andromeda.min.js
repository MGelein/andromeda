"use strict";var andromeda={version:0.1,author:"Mees Gelein"};(function(e){var m="http://www.perseus.tufts.edu/hopper/loadquery";var c="http://www.perseus.tufts.edu/hopper/searchresults?q=";var d="http://www.perseus.tufts.edu/hopper/";var n=10;var b="<div class='row'><hr><div class='col-sm-12 text-center'><h4>Navigation</h4></div><div class='col-sm-6 text-center'><span id='prevSeg' class='greyed-out'>◀&nbsp;Previous Segment</span></div><div class='col-sm-6 text-center'><span id='nextSeg' class='greyed-out'>&nbsp;Next Segment&nbsp;▶</span></div><hr><div class='col-sm-12 text-center'><h4>Save &amp; Load</h4></div></div>";var k=function(){var t=$("#loadFromPerseusQuery").val().trim();$("#loadFromPerseusQuery").val("");if(t.length==0){return}$("#loadFromPerseusButton").val("Loading...").removeClass("btn-primary").addClass("btn-warning");var s=t;if(!t.startsWith("http")){s=c+encodeURI(t)}a(s)};var a=function(s){var t="<br><h3>No Dictionary</h3><p>There are no word queries to display. To get started using the dictionary click a word in the main text in the middle column.</p>";var u="<br><h3>No Notes</h3><p>There are no notes to display. To get started taking notes make a selection in the main text in the middle column and press the 'Add Note' button.</p>";$("#dictionaryContent").html(t);$("#noteContent").html(u);e.environment.translations=[];e.environment.text={};$.ajax({url:s,success:function(x){if(x.indexOf("<title>Perseus Search results</title>")!=-1||x.indexOf('<link href="/js/perseusld/perseusld.css" rel="stylesheet" type="text/css"/>')==-1){$("#loadFromPerseusButton").val("Not A Known Text").removeClass("btn-warning").addClass("btn-danger");setTimeout(function(){$("#loadFromPerseusButton").val("Load From Perseus").removeClass("btn-danger").addClass("btn-primary")},2000)}else{x=x.replace(/<img/g,"<span");var w=$(x);var A=w.find(".current").filter(":last").get(0);e.environment.text.doc=m+$(A).attr("href");e.environment.text.name=$(A).attr("title");e.environment.text.section=$(w.find(".current").get(0)).attr("title");e.environment.text.title=$(w.find("#header_text").get(0)).find("h1").get(0).textContent;var z=w.find('.arrow span[alt="next"]').get(0);var B=w.find('.arrow span[alt="previous"]').get(0);if(z!=undefined){e.environment.text.next=d+$(z).parent().attr("href")}else{e.environment.text.next=undefined}if(B!=undefined){e.environment.text.prev=d+$(B).parent().attr("href")}else{e.environment.text.prev=undefined}l();var y=0;while(true){var C=w.find("#translation"+y+" .header");if(C.length<1){break}var v=C.get(0);e.environment.translations.push({title:v.textContent.split("\n")[3],doc:m+$($(v).find(".toggle").get(1)).attr("href").replace("text","")});y++}o()}$(".greyed-out").removeClass("greyed-out");g()}})};var r=function(s,t){$("#translationContent").html(s);$("#translationHeader").html('Translation: <span class="titleName">'+t+"</span>")};var o=function(){$("#translationContent").html("");e.environment.translations.dropdown="";$.each(e.environment.translations,function(s,t){$.ajax({url:t.doc,success:function(u){u=u.replace(/<hr[^>]*>/g,"");u=u.replace(/<img[^>]*>/g,"");t.data=u;e.environment.translations.dropdown+="<div class='dropdownLink' resultIndex='"+s+"'><span class='dropdownIcon'/>"+t.title+"</div>";if(s==0){r(u,t.title)}}})});$("#translationHeader").unbind("click").click(function(t){t.stopPropagation();var s=$("#headerDropdown");if(!e.ui.dropdownShowing){e.ui.dropdownShowing=true;var u=function(){var v=$("#translationHeader");var w=v.offset();s.offset({top:0,left:0});s.html(e.environment.translations.dropdown);s.offset({top:w.top+v.height(),left:w.left});s.innerWidth(v.outerWidth())};u();$(window).unbind("resize").resize(u);$(document).click(function(){g()});s.find(".dropdownLink").each(function(v,w){if($("#translationHeader").text().indexOf($(w).text())==-1){return}$($(w).find(".dropdownIcon").get(0)).addClass("dropdownActiveIcon")});s.fadeIn();s.find(".dropdownLink").click(function(v){r(e.environment.translations[$(this).attr("resultIndex")].data,$(this).text())})}else{g()}})};var g=function(){var s=$("#headerDropdown");$(window).unbind("resize");$(document).unbind("click");e.ui.dropdownShowing=false;s.html("");s.offset({top:0,left:0});s.innerWidth(0);s.hide()};var l=function(){$("#textHeader").html("Text: Loading");$("#textContent").html("");$.ajax({url:e.environment.text.doc,success:function(s){s=s.replace(/<hr[^>]*>/g,"");$("#textContent").html(s);$("#textHeader").html('Text: <span class="titleName">'+e.environment.text.title+" | "+e.environment.text.name+"</span>");f();e.environment.text.dropdown=b;$("#textHeader").unbind("click").click(function(v){v.stopPropagation();var u=$("#headerDropdown");if(!e.ui.dropdownShowing){e.ui.dropdownShowing=true;var x=function(){var y=$("#textHeader");var z=y.offset();u.offset({top:0,left:0});u.html(e.environment.text.dropdown);u.offset({top:z.top+y.height(),left:z.left});u.innerWidth(y.outerWidth())};x();$(window).unbind("resize").resize(x);$(document).click(function(){g()});if(e.environment.text.next!=undefined){var w=$(u.find("#nextSeg").get(0));w.addClass("textNav").removeClass("greyed-out");w.unbind("click").click(function(y){y.stopPropagation();w.html("Loading...");a(e.environment.text.next)})}if(e.environment.text.prev!=undefined){var t=$(u.find("#prevSeg").get(0));t.addClass("textNav").removeClass("greyed-out");t.unbind("click").click(function(y){y.stopPropagation();t.html("Loading...");a(e.environment.text.prev)})}u.fadeIn()}else{g()}})}})};var p=function(t,u,s){$("#dictionaryHeader").html("Dictionary: "+u+' <span class="locus">'+s+"</span>");$("#dictionaryContent").html(t)};var h=function(t,w,u){var s=d+t;var v=false;$.each(e.environment.dictionary.cache,function(x,y){if(y.wordUrl==s){p(y.data,y.wordTitle,y.loc);v=true}});if(v){return}$.ajax({url:s,success:function(x){x=x.replace(/<img[^>]*>/g,"");var y=$(x).find("#main_col").get(0);$("#dictionaryContent").html(y.innerHTML);$("#dictionaryContent table").addClass("table table-condensed table-striped");$("#dictionaryContent .word_freq").remove();$('#dictionaryContent a[href="#lexicon"]').each(function(z,A){$(A).closest(".lemma").append(A);$(A).addClass("btn btn-primary btn-sm lexLink");$(A).removeAttr("onclick");$(A).prop("onclick",null);$(A).attr("href","#");var B=$(A).attr("id");$(A).attr("id",B.substr(0,B.length-5))});$("#dictionaryContent p").remove();if($("#dictionaryContent").html().trim().length==0){$("#dictionaryContent").html("<h3>Sorry!</h3><p>It looks like no result could be found for that word.</p>")}$("#dictionaryContent").find(".lexLink").attr("onclick","andromeda.search.loadLexicon(event, this);");p($("#dictionaryContent").html(),w,u);i(w,$("#dictionaryContent").html(),s,u);$("#dictionaryHeader").unbind("click").click(function(A){A.stopPropagation();var z=$("#headerDropdown");if(!e.ui.dropdownShowing){e.ui.dropdownShowing=true;var B=function(){var C=$("#dictionaryHeader");var D=C.offset();z.offset({top:0,left:0});z.html(e.environment.dictionary.dropdown);z.offset({top:D.top+C.height(),left:D.left});z.innerWidth(C.outerWidth())};B();$(window).unbind("resize").resize(B);$(document).click(function(){g()});z.find(".dropdownLink").each(function(C,D){if($("#dictionaryHeader").text().indexOf($(D).text())==-1){return}$($(D).find(".dropdownIcon").get(0)).addClass("dropdownActiveIcon")});z.fadeIn();z.find(".dropdownLink").click(function(C){var D=e.environment.dictionary.cache[$(this).attr("resultIndex")];p(D.data,D.wordTitle,D.loc)})}else{g()}})}})};var j=function(x,w){x.stopPropagation();var y=w.textContent;var s=$(w).closest(".lemma").find("h4").get(0).textContent;var v=s+"&nbsp;<span class='lexiconName'>("+y+")</span>";var t=m+"?doc="+w.id;var u=false;$.each(e.environment.dictionary.cache,function(z,A){if(A.wordUrl==t){p(A.data,A.wordTitle,A.loc);u=true}});if(u){return}$.ajax({url:t,success:function(z){i(v,z,t,"");p(z,v)}})};var i=function(w,v,t,u){var s={wordTitle:w,data:v,wordUrl:t,loc:u};e.environment.dictionary.cache.unshift(s);if(e.environment.dictionary.cache.length>n){e.environment.dictionary.cache.pop()}e.environment.dictionary.dropdown="";$.each(e.environment.dictionary.cache,function(x,y){e.environment.dictionary.dropdown+="<div class='dropdownLink' resultIndex="+x+"><span class='dropdownIcon'/>"+y.wordTitle+" "+y.loc+"</div>"})};var f=function(){$(".text a").unbind("click").attr("onclick","");$(".text a").click(function(x){x.preventDefault();var t=$(this).prevAll("span").get(0);var s=(t==undefined)?"":t.textContent;var v=e.environment.text.name;if(t==undefined){if(v.startsWith("lines")){s=v.split(" ")[1].split("-")[0]}else{if(v.startsWith("chapter")||v.startsWith("book")){s="1"}else{if(v.startsWith("poem")){s=""}}}}var w=$(this).text();var u=(e.environment.text.section!==e.environment.text.name)?e.environment.text.section:"";u+=(!v.startsWith("lines"))?e.environment.text.name:"";if(u.length>0&&s.length>0){u+="."}u+=s.toString();h($(this).attr("href"),w,u)})};var q=function(){$("#loadFromPerseusButton").click(function(){andromeda.search.perseus()});$("#loadFromPerseusQuery").keydown(function(s){if(s.keyCode==13){k()}})};e.search={perseus:k,loadLexicon:j};e.ui={registerClickHandlers:q,dropdownShowing:false};e.environment={text:{},translations:[],dictionary:{cache:[]}}})(andromeda);$(document).ready(function(){andromeda.ui.registerClickHandlers();$("#headerDropdown").hide()});